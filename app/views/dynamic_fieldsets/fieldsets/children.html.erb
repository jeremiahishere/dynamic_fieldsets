<h3 class="fieldset name"><%= @fieldset.name %></h3>
<p class="fieldset description"><%= @fieldset.description %></p>

<script>
$(function() {

    $( "#enable-sorting" ).toggle( function() {
      // Enable sorting
      $( "#children" ).sortable('enable');
      $( "#children" ).addClass('sort');
      $( "#children" ).find('.admin').css('visibility','hidden');
      $("#enable-sorting").html('Save');
    }, function() {
      // Disable sorting, save results
      $( "#children" ).sortable('disable');
      $( "#children" ).removeClass('sort');
      $( "#children" ).find('.admin').css('visibility','visible');
      newOrder = getOrdering( $('#children').nestedSortable('toArray') );
    });
    
    $( "#children" ).nestedSortable({
        forcePlaceholderSize: true,
        disableNesting: 'field',
        handle: 'div',
        helper: 'clone',
        items: 'li',
        opacity: .75,
        placeholder: 'placeholder',
        revert: 250,
        tabSize: 25,
        toleranceElement: 'div'
      }).sortable('disable');
      
    order = getOrdering( $('#children').nestedSortable('toArray') );
    
    function getOrdering(arr) {
      var newArray = arr.map( function(val,index) { return index + ":" + val.item_id + ":" + val.parent_id } );
      newArray.shift();
      return newArray;
    }
    
    function delta(base_arr, new_arr) {
      var del = new Array;
      for( i in new_arr ) {
        if( jQuery.inArray( new_arr[i], base_arr ) == -1 ) { // is NOT in base array
          del.push(new_arr[i]);
        }
      }
      return del;
    }
    
    window.r=delta
    
    
});
</script>

<button type="button" id="enable-sorting">Change Ordering</button>

<ol id="children">
<%= render :partial => 'child', :locals => { :fieldset => @fieldset } %>
</ol>

<%= link_to 'Add Field', new_dynamic_fieldsets_field_path(:parent => @fieldset.id)  %> | 
<%= link_to 'Add Fieldset', new_dynamic_fieldsets_fieldset_path(:parent => @fieldset.id) %> | 
<%= link_to 'Show Parent Fieldset', dynamic_fieldsets_fieldset_path(@fieldset) %> |
<%= link_to 'Return to Manager', :controller => :fieldsets, :action => :roots %>

<br />